<div class="d-flex flex-row p-3">
    <div class="w-50">
        <form (ngSubmit)="searchSubmit(searchForm)" #searchForm="ngForm">
            <div class="input-group">
                <type-ahead placeholder="Search question : 1.1, 1.2, ..." name="search"
                    [suggestions]="dataService.questions" class="form-control" [multi]="true" [custom]="false"
                    [settings]="typeaheadSettings" ngModel>
                </type-ahead>
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" id="search-submit" type="submit">Search</button>
                </div>
            </div>
        </form>
    </div>
    <div class="pl-2">
        <select class="form-control" [disabled]="!dataService.repositories || loading" [(ngModel)]="tpGroup"
            (change)="this.loadGraphDataAndRefresh()" placeholder="d.ff">
            <option [ngValue]="undefined" hidden disabled>Select a tp group</option>
            <option *ngFor="let tpGroup of dataService.tpGroups" [value]="tpGroup">{{tpGroup}}</option>
            <option value="">All</option>
        </select>
    </div>
    <div class="separator"></div>
    <div>
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" [disabled]="!dataService.repositories || loading"
                type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                title="Show or hide milestones" data-trigger="hover">
                Markers
            </button>
            <div class="dropdown-menu">
                <form class="px-4 py-3">
                    <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="sessionsSwitch"
                            [(ngModel)]="showSessions" (change)="this.loadGraphDataAndRefresh()"
                            [ngModelOptions]="{standalone: true}">
                        <label class="custom-control-label" for="sessionsSwitch">Sessions</label>
                    </div>
                    <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="correctionsSwitch"
                            [(ngModel)]="showCorrections" (change)="this.loadGraphDataAndRefresh()"
                            [ngModelOptions]="{standalone: true}">
                        <label class="custom-control-label" for="correctionsSwitch">Corrections</label>
                    </div>
                    <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" selected id="reviewsSwitch"
                            [(ngModel)]="showReviews" (change)="this.loadGraphDataAndRefresh()"
                            [ngModelOptions]="{standalone: true}">
                        <label class="custom-control-label" for="reviewsSwitch">Reviews</label>
                    </div>
                    <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" selected id="othersSwitch"
                            [(ngModel)]="showOthers" (change)="this.loadGraphDataAndRefresh()"
                            [ngModelOptions]="{standalone: true}">
                        <label class="custom-control-label" for="othersSwitch">Others</label>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="separator"></div>
    <div>
        <div class="btn-group" role="group" aria-label="Interaction controls">
            <button class="btn btn-outline-secondary" [disabled]="!dataService.repositories || loading"
                (click)="resetZoom()" data-toggle="tooltip" title="Reset zoom (space bar)" data-trigger="hover">
                <span class="fa-layers fa-fw">
                    <i class="fas fa-search"></i>
                    <i class="fas fa-times" data-fa-transform="shrink-8 up-1.6 left-2"></i>
                </span>
            </button>
            <button class="btn btn-outline-secondary" data-toggle="tooltip"
                title="Change zoom mode (drag/wheel and pan)" data-trigger="hover"
                [disabled]="!dataService.repositories || loading" (click)="changeZoom()">
                <div *ngIf="drag">
                    <span class="fa-layers fa-fw">
                        <i class="fas fa-mouse-pointer" data-fa-transform="shrink-2 right-5 down-6"></i>
                        <i class="far fa-square" data-fa-transform="shrink-2 up-6 left-5"></i>
                    </span>
                </div>
                <div *ngIf="!drag">
                    <span class="fa-layers fa-fw">
                        <i class="fas fa-mouse-pointer" data-fa-transform="shrink-2 right-5 down-6"></i>
                        <i class="fas fa-arrows-alt-h" data-fa-transform="up-6 left-5"></i>
                    </span>
                </div>
            </button>
            <button class="btn btn-outline-secondary" (click)="changeUnit()" data-toggle="tooltip"
                title="Change the time scale" [disabled]="!dataService.repositories || loading" data-trigger="hover">
                <div *ngIf="unit === 'week'"><i class="fas fa-calendar-week"></i></div>
                <div *ngIf="unit === 'hour'"><i class="fas fa-clock"></i></div>
                <div *ngIf="unit === 'day'"><i class="fas fa-calendar-day"></i></div>
            </button>
        </div>
    </div>
    <div class="separator"></div>
    <div>
        <div class="btn-group" role="group" aria-label="File controls">
            <button class="btn btn-outline-secondary" title="Download JSON" (click)="download()"
                [disabled]="!dataService.repositories || loading" data-toggle="tooltip" data-trigger="hover"><i
                    class="fas fa-download"></i></button>
            <button class="btn btn-outline-secondary" title="Upload JSON" data-toggle="modal"
                data-target="#uploadFileModal" data-trigger="hover"><i class="fas fa-upload"></i></button>
            <button class="btn btn-outline-secondary" (click)="readFile()" [disabled]="!jsonManager.file || loading"
                data-toggle="tooltip" title="Reload" data-trigger="hover">
                <div *ngIf="loading"><i class="fas fa-redo-alt fa-spin"></i></div>
                <div *ngIf="!loading"><i class="fas fa-redo-alt"></i></div>
            </button>
        </div>
    </div>
</div>
<div class="chart-container">
    <canvas #myChart id="myChart" baseChart [chartType]="'line'" [datasets]="chartData" [options]="chartOptions"
        [legend]="false" (chartClick)="onChartClick($event)" (chartHover)="onChartHover($event)">
    </canvas>
</div>
<div class="card">
    <h5 class="card-header">
        <a data-toggle="collapse" href="#legendCollapse" aria-expanded="true" aria-controls="legendCollapse"
            style="text-decoration:none" id="heading-example" class="d-block collapsed">
            <i class="fa fa-chevron-down float-right"></i>
            Legend
        </a>
    </h5>
    <div id="legendCollapse" class="collapse">
        <div class="card-body">
            <p class="card-text">
                <i class="far fa-square fa-fw" data-fa-transform="rotate-45"></i> Commit
                <i class="far fa-circle fa-fw ml-3"></i> Closing commit<br>
                <i class="fas fa-circle fa-fw" style="color:rgb(77, 77, 77)"></i> Intermediate commit
                <i class="fas fa-circle fa-fw ml-3" style="color:rgb(53, 198, 146)"></i> Before review
                <i class="fas fa-circle fa-fw ml-3" style="color:rgb(255, 127, 74)"></i> Between review and correction
                <i class="fas fa-circle fa-fw ml-3" style="color:rgb(203, 91, 68)"></i> After correction<br>
                <i class="fas fa-minus" data-fa-transform="rotate-90" style="color:blue"></i> Review
                <i class="fas fa-minus ml-3" data-fa-transform="rotate-90" style="color:red"></i> Correction
                <i class="fas fa-minus ml-3" data-fa-transform="rotate-90"></i> Other<br>
                <span class="fa-layers fa-fw">
                    <i class="fas fa-square" style="color:rgba(33, 150, 243, 0.15)"></i>
                    <i class="far fa-square" style="color:rgba(79, 195, 247,1.0)"></i>
                </span> Session
            </p>
        </div>
    </div>
</div>



<div class="modal fade" id="addMilestoneModal" tabindex="-1" role="dialog" aria-labelledby="addMilestoneModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addMilestoneModalLabel">{{this.addModal ? 'Create' : 'Edit'}} milestone</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="was-validated" (ngSubmit)="onSubmit(f)" #f="ngForm">
                    <div class="form-group">
                        <label for="date" class="col-form-label">Date :</label>
                        <input class="form-control" type="datetime-local" [ngModel]="dateModal" id="date" name="date"
                            required ngModel>
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Label :</label>
                        <input type="text" class="form-control" id="recipient-name" name="label" [ngModel]="labelModal"
                            ngModel>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">TP group :</label>
                        <select class="form-control" [ngModel]="tpGroupModal" (change)="this.loadGraphDataAndRefresh()"
                            placeholder="d.ff" name="tpGroup" id="tpGroup">
                            <option *ngFor="let tpGroup of dataService.tpGroups" [value]="tpGroup">{{tpGroup}}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label id="questions-tooltip" for="questions" class="col-form-label">Questions :</label>
                        <type-ahead placeholder="Select question(s) : 1.1, 1.2, ..." name="questions" id="questions"
                            [ngModel]="questionsModal" [suggestions]="dataService.questions" class="form-control"
                            [multi]="true" [custom]="false" [settings]="typeaheadSettings" ngModel>
                        </type-ahead>
                    </div>
                    <div class="custom-control custom-radio custom-control-inline">
                        <input type="radio" id="customRadio1" name="jalon" class="custom-control-input"
                            value="corrections" [ngModel]="typeModal" required ngModel>
                        <label class="custom-control-label" for="customRadio1">Correction</label>
                    </div>
                    <div class="custom-control custom-radio custom-control-inline">
                        <input type="radio" id="customRadio2" name="jalon" class="custom-control-input" value="reviews"
                            [ngModel]="typeModal" required ngModel>
                        <label class="custom-control-label" for="customRadio2">Review</label>
                    </div>
                    <div class="custom-control custom-radio custom-control-inline">
                        <input type="radio" id="customRadio3" name="jalon" class="custom-control-input" value="others"
                            [ngModel]="typeModal" required ngModel>
                        <label class="custom-control-label" for="customRadio3">Other</label>
                    </div>
                    <hr>
                    <button *ngIf="!addModal" type="button" class="btn btn-danger col-5"
                        (click)="deleteMilestone()">Delete
                        milestone</button>
                    <button type="submit" class="btn btn-primary col-5 float-right"
                        [disabled]="f.invalid">Confirm</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="uploadFileModal" tabindex="-1" role="dialog" aria-labelledby="uploadFileModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadFileModalLabel">Upload file</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="d-flex flex-row">
                    <div class="input-group">
                        <div class="input-group-prepend ">
                            <span class="input-group-text" id="inputGroupFileAddon01"><i
                                    class="fas fa-upload"></i></span>
                        </div>
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="inputGroupFile01"
                                aria-describedby="inputGroupFileAddon01" (change)="changeListener($event)" />
                            <label class="custom-file-label" for="inputGroupFile01">{{
                                                        jsonManager.filename || 'Choose file'
                                          }}</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>